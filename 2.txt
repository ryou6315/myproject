from scapy.all import IP, TCP, sr1
import time

def tcp_traceroute(dest, port=443, max_hops=30):
    print(f"TCP Traceroute to {dest}:{port}")
    for ttl in range(1, max_hops + 1):
        pkt = IP(dst=dest, ttl=ttl) / TCP(dport=port, flags="S")
        start = time.time()
        reply = sr1(pkt, timeout=2, verbose=0)
        rtt = (time.time() - start) * 1000
        if reply is None:
            print(f"{ttl}\t*")
        elif reply.haslayer("TCP"):
            print(f"{ttl}\t{reply.src}\t{round(rtt,2)} ms\tTCPå“åº”")
            if reply.getlayer("TCP").flags == 0x12:  # SYN-ACK
                print("ğŸ¯ åˆ°è¾¾ç›®æ ‡")
                break
        elif reply.haslayer("ICMP"):
            print(f"{ttl}\t{reply.src}\t{round(rtt,2)} ms\tICMPå“åº”")
        else:
            print(f"{ttl}\tæœªçŸ¥å“åº”")

tcp_traceroute("teams.microsoft.com")
