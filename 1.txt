import os
import re
import pandas as pd

# 指定目录路径
directory = "指定目录路径"

# 初始化集合用于存储结果
result_set = set()

# 遍历目录中的所有 Excel 文件
for file_name in os.listdir(directory):
    if file_name.endswith(".xlsx"):
        file_path = os.path.join(directory, file_name)
        print(f"处理文件: {file_name}")

        # 打开 Excel 文件
        try:
            excel_file = pd.ExcelFile(file_path)

            # 遍历所有 Sheet
            for sheet_name in excel_file.sheet_names:
                sheet_data = excel_file.parse(sheet_name)

                # 检查 [处理sheet]
                if sheet_name == "[处理sheet]":
                    # 遍历每个单元格，查找包含 "JOB001" 的内容
                    for row in sheet_data.values:
                        for cell in row:
                            if isinstance(cell, str) and "JOB001" in cell:
                                result_set.add(cell)  # 将结果添加到集合

                # 检查其他 Sheet 中的 "SF注释"
                else:
                    # 遍历每个单元格，查找类似 `call "SF注释"('abc');` 的内容
                    for row in sheet_data.values:
                        for cell in row:
                            if isinstance(cell, str):
                                match = re.search(r'call "SF注释"\(\'(.*?)\'\);', cell)
                                if match:
                                    result_set.add(match.group(1))  # 提取括号内的内容并添加到集合
        
        except Exception as e:
            print(f"处理文件 {file_name} 时发生错误: {e}")

# 输出结果
print("\n处理结果:")
print(result_set)
