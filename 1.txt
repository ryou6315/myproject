import os
import json
import csv

# 指定包含ADF JSON文件的目录路径
json_dir = 'your_adf_export_folder'

# 输出的CSV文件
output_csv = 'adf_summary.csv'

# 打开CSV文件用于写入
with open(output_csv, mode='w', newline='', encoding='utf-8') as csvfile:
    writer = csv.writer(csvfile)
    # 写入CSV表头
    writer.writerow(['file_name', 'resource_name', 'lastPublishedTime'])

    # 遍历目录中的每个文件
    for filename in os.listdir(json_dir):
        if filename.endswith('.json'):
            file_path = os.path.join(json_dir, filename)
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    data = json.load(f)

                    # 提取 lastPublishedTime，如果没有设置为空
                    last_published = data.get('lastPublishedTime', '')

                    # 遍历 resources 数组
                    resources = data.get('resources', [])
                    for res in resources:
                        name = res.get('name', '')
                        writer.writerow([filename, name, last_published])

            except Exception as e:
                print(f"解析文件 {filename} 出错：{e}")
